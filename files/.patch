diff -urp a/opt/atlassian/bitbucket/bin/set-bitbucket-home.sh b/opt/atlassian/bitbucket/bin/set-bitbucket-home.sh
--- a/opt/atlassian/bitbucket/bin/set-bitbucket-home.sh	2018-03-14 08:55:04.766651496 +0800
+++ b/opt/atlassian/bitbucket/bin/set-bitbucket-home.sh	2018-03-10 22:10:03.658417708 +0800
@@ -2,7 +2,7 @@
 # /bitbucket/home.  You can of course set it outside in the command terminal; that will also work.
 #
 if [ -z "$BITBUCKET_HOME" ]; then
-    BITBUCKET_HOME=
+    BITBUCKET_HOME=${BITBUCKET_HOME:-/var/atlassian/application-data/bitbucket}
 fi
 
 # When upgrading from the packaged distribution BITBUCKET_HOME may not be set. Fallback to legacy STASH_HOME
diff -urp a/opt/atlassian/bitbucket/bin/set-bitbucket-user.sh b/opt/atlassian/bitbucket/bin/set-bitbucket-user.sh
--- a/opt/atlassian/bitbucket/bin/set-bitbucket-user.sh	2018-03-14 08:54:16.649488562 +0800
+++ b/opt/atlassian/bitbucket/bin/set-bitbucket-user.sh	2018-03-10 22:10:03.662417597 +0800
@@ -1,9 +1,9 @@
-if [ -n "${BITBUCKET_USER}" ]; then
+if [ -n "${BITBUCKET_OWNER}" ]; then
     return
 fi
 
 # START INSTALLER MAGIC ! DO NOT EDIT !
-BITBUCKET_USER="" ##
+BITBUCKET_OWNER="${BITBUCKET_OWNER:-daemon}" ##
 # END INSTALLER MAGIC ! DO NOT EDIT !
 
-export BITBUCKET_USER
+export BITBUCKET_OWNER
diff -urp a/opt/atlassian/bitbucket/bin/start-bitbucket.sh b/opt/atlassian/bitbucket/bin/start-bitbucket.sh
--- a/opt/atlassian/bitbucket/bin/start-bitbucket.sh	2018-03-14 08:54:23.034286787 +0800
+++ b/opt/atlassian/bitbucket/bin/start-bitbucket.sh	2018-03-10 22:10:03.662417597 +0800
@@ -52,7 +52,7 @@ else
     LAUNCH_CMD=start
 fi
 
-if [ -z "$BITBUCKET_USER" ] || [ $(id -un) == "$BITBUCKET_USER" ]; then
+if [ -z "$BITBUCKET_OWNER" ] || [ $(id -un) == "$BITBUCKET_OWNER" ]; then
     echo "Starting Atlassian Bitbucket as the current user"
 
     if [ -z "$NO_SEARCH" ]; then
@@ -64,11 +64,11 @@ if [ -z "$BITBUCKET_USER" ] || [ $(id -u
         $BIN_DIR/_stop-search.sh
     fi
 elif [ $UID -ne 0 ]; then
-    echo Atlassian Bitbucket has been installed to run as $BITBUCKET_USER. Use "sudo -u $BITBUCKET_USER $0"
+    echo Atlassian Bitbucket has been installed to run as $BITBUCKET_OWNER. Use "sudo -u $BITBUCKET_OWNER $0"
     echo to start as that user.
     exit 1
 else
-    echo "Starting Atlassian Bitbucket as dedicated user $BITBUCKET_USER"
+    echo "Starting Atlassian Bitbucket as dedicated user $BITBUCKET_OWNER"
 
     if [ -x "/sbin/runuser" ]; then
         SU="/sbin/runuser"
@@ -76,7 +76,7 @@ else
         SU="su"
     fi
 
-    $SU -l $BITBUCKET_USER <<EOS
+    $SU -l $BITBUCKET_OWNER <<EOS
         # Copy over the environment, the poor man's way
         export BIN_DIR="$BIN_DIR"
         export BITBUCKET_HOME="$BITBUCKET_HOME"
@@ -107,4 +107,4 @@ else
             $BIN_DIR/_stop-search.sh
         fi
 EOS
-fi
\ No newline at end of file
+fi
diff -urp a/opt/atlassian/bitbucket/bin/_start-webapp.sh b/opt/atlassian/bitbucket/bin/_start-webapp.sh
--- a/opt/atlassian/bitbucket/bin/_start-webapp.sh	2018-03-14 08:53:59.399684153 +0800
+++ b/opt/atlassian/bitbucket/bin/_start-webapp.sh	2018-03-10 22:10:03.658417708 +0800
@@ -11,22 +11,22 @@ fi
 # environment variable has been set in the environment of the user running this script, uncommenting the below
 # will override that.
 #
-#JVM_SUPPORT_RECOMMENDED_ARGS=
+JVM_SUPPORT_RECOMMENDED_ARGS="${JVM_SUPPORT_RECOMMENDED_ARGS:-"-Datlassian.plugins.enable.wait=300"}"
 
 # The following 2 settings control the minimum and maximum memory allocated to the Java virtual machine.
 # For larger instances, the maximum amount will need to be increased.
 #
 if [ -z "${JVM_MINIMUM_MEMORY}" ]; then
-    JVM_MINIMUM_MEMORY=512m
+    JVM_MINIMUM_MEMORY=${JVM_MINIMUM_MEMORY:-512m}
 fi
 if [ -z "${JVM_MAXIMUM_MEMORY}" ]; then
-    JVM_MAXIMUM_MEMORY=1g
+    JVM_MAXIMUM_MEMORY=${JVM_MAXIMUM_MEMORY:-1024m}
 fi
 
 # Uncommenting the following will set the umask for the webapp. It can be used to override the default
 # settings for the service user if they are not sufficiently secure.
 #
-# umask 0027
+umask 0027
 
 UMASK=$(umask)
 UMASK_SYMBOLIC=$(umask -S)
@@ -111,4 +111,4 @@ else
 
         echo "There was a problem starting the Bitbucket webapp"
     fi
-fi
\ No newline at end of file
+fi
diff -urp a/opt/atlassian/bitbucket/bin/stop-bitbucket.sh b/opt/atlassian/bitbucket/bin/stop-bitbucket.sh
--- a/opt/atlassian/bitbucket/bin/stop-bitbucket.sh	2018-03-14 08:55:32.905394551 +0800
+++ b/opt/atlassian/bitbucket/bin/stop-bitbucket.sh	2018-03-10 22:10:03.662417597 +0800
@@ -22,7 +22,7 @@ if [ -z "$BITBUCKET_HOME" ]; then
     exit 1
 fi
 
-if [ -z "$BITBUCKET_USER" ] || [ $(id -un) == "$BITBUCKET_USER" ]; then
+if [ -z "$BITBUCKET_OWNER" ] || [ $(id -un) == "$BITBUCKET_OWNER" ]; then
     echo "Stopping Atlassian Bitbucket as the current user"
 
     # Stop webapp first, then stop Elasticsearch. Each stop script relies on a PID file generated by
@@ -30,11 +30,11 @@ if [ -z "$BITBUCKET_USER" ] || [ $(id -u
     $BIN_DIR/_stop-webapp.sh
     $BIN_DIR/_stop-search.sh
 elif [ $UID -ne 0 ]; then
-    echo Atlassian Bitbucket has been installed to run as $BITBUCKET_USER, and can only be stopped by that
-    echo user. Use "sudo -u $BITBUCKET_USER $0" to stop Bitbucket.
+    echo Atlassian Bitbucket has been installed to run as $BITBUCKET_OWNER, and can only be stopped by that
+    echo user. Use "sudo -u $BITBUCKET_OWNER $0" to stop Bitbucket.
     exit 1
 else
-    echo "Stopping Atlassian Bitbucket as dedicated user $BITBUCKET_USER"
+    echo "Stopping Atlassian Bitbucket as dedicated user $BITBUCKET_OWNER"
 
     if [ -x "/sbin/runuser" ]; then
         SU="/sbin/runuser"
@@ -42,7 +42,7 @@ else
         SU="su"
     fi
 
-    $SU -l $BITBUCKET_USER <<EOS
+    $SU -l $BITBUCKET_OWNER <<EOS
         # Copy over the environment, the poor man's way
         export BITBUCKET_HOME="$BITBUCKET_HOME"
         export BIN_DIR="$BIN_DIR"
